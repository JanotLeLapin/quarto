<!doctype html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <title>quarto example</title>
  <link rel="stylesheet" href="quarto.css" />
</head>

<body>
  <script type="module">
    import init, {QuartoEngine} from "./pkg/quarto_wasm.js";

    let quarto

    let boardSlots = []

    function initBoard() {
      const board = document.getElementById("board")
      for (let i = 0; i < 16; i++) {
        const slot = document.createElement("div")
        slot.classList.add("piece")
        boardSlots.push(slot)
        board.appendChild(slot)
      }
    }

    function updateBoardSlot(x, y, piece) {
      const i = x * 4 + y
      const slot = boardSlots[i]

      if ((piece & 0x01) == 0x01) {
        slot.classList.add("is-light")
      } else {
        slot.classList.add("is-dark")
      }

      if ((piece & 0x02) == 0x02) {
        slot.classList.add("is-square")
      } else {
        slot.classList.add("is-circle")
      }

      if ((piece & 0x04) == 0x04) {
        slot.classList.add("is-tall")
      } else {
        slot.classList.add("is-short")
      }

      if ((piece & 0x08) == 0x08) {
        slot.classList.add("is-hollow")
      }
    }

    init().then(() => {
      quarto = new QuartoEngine()
      initBoard()

      console.log("initialized")
    });

    document.getElementById("next").addEventListener("click", (_) => {
      console.log("clicked")
      console.log(quarto.get_board())

      if (undefined != quarto.get_winner()) {
        console.log("winner: " + quarto.get_winner())
        return
      }

      let piece = quarto.give_piece()
      quarto.pick_piece(piece)
      console.log("will play " + piece)

      let [x, y] = quarto.play_piece(piece)
      quarto.place_piece(x, y, piece)
      console.log("at " + x + ", " + y)

      updateBoardSlot(x, y, piece)
    })
  </script>

  <div id="board"></div>

  <button id="next">Next</button>
</body>

</html>